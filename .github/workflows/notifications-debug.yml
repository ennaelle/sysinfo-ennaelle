name: notification debug
on: push

jobs:
    C-lint-sysinfo:
      runs-on: ubuntu-latest
      steps:
            - name: sysinfo checkout
              uses: actions/checkout@v6
              
            - name: sysinfo lint
              run: |
                echo "::group::üîç Linting du code C"
                if make lint; then
                  echo "::endgroup::"
                  echo "::notice title=‚úÖ Lint C r√©ussi::Le code C respecte les normes de codage"
                else
                  echo "::endgroup::"
                  echo "::error title=‚ùå Lint √©chou√©::Des erreurs de style ont √©t√© d√©tect√©es dans le code C"
                  exit 1
                fi

    C-compilation-sysinfo:
        runs-on: ubuntu-latest
        needs: C-lint-sysinfo
        steps:
            - name: sysinfo checkout
              uses: actions/checkout@v6
              
            - name: sysinfo compilation
              run: |
                echo "::warning::D√©but de la compilation en mode release"
                echo "::group::üî® Compilation du projet C"
                
                if make build; then
                  echo "::endgroup::"
                  echo "::notice title=‚úÖ Build r√©ussi::Compilation C termin√©e avec succ√®s"
                  
                  # Afficher la taille du binaire
                  if [ -f ./sysinfo ]; then
                    SIZE=$(du -h ./sysinfo | cut -f1)
                    echo "::notice title=Taille du binaire::Binaire g√©n√©r√© : $SIZE"
                  fi
                else
                  echo "::endgroup::"
                  echo "::error title=‚ùå Compilation √©chou√©e::Erreurs de compilation d√©tect√©es"
                  exit 1
                fi
    
    Py-lint-mysystem:
        runs-on: ubuntu-latest
        steps:
            - name: sysinfo checkout
              uses: actions/checkout@v6
              
            - name: Python environment
              uses: actions/setup-python@v5
              with:
                python-version: 3.12
                
            - name: lint verification
              run: |
                echo "::group::üì¶ Installation des d√©pendances Python"
                pip install --quiet ifaddr psutil pylint
                echo "D√©pendances install√©es : ifaddr, psutil, pylint"
                echo "::endgroup::"
                
                echo "::group::üîç Analyse Pylint du script mysystem"
                if pylint --disable=missing-docstring script/mysystem/mysystem.py; then
                  echo "::endgroup::"
                  echo "::notice title=‚úÖ Lint Python r√©ussi::Le script Python respecte les standards PEP8"
                else
                  SCORE=$?
                  echo "::endgroup::"
                  echo "::warning title=‚ö†Ô∏è Avertissements Pylint::Des am√©liorations de code sont sugg√©r√©es (score: $SCORE/10)"
                  # Ne pas √©chouer le job, juste avertir
                fi
                
    Py-run-mysystem:
        runs-on: ubuntu-latest
        needs: Py-lint-mysystem   
        steps:
            - name: sysinfo checkout
              uses: actions/checkout@v6
              
            - name: Python environment
              uses: actions/setup-python@v5
              with:
                python-version: 3.12
                
            - name: run script
              run: |
                echo "::group::üì¶ Installation des d√©pendances"
                pip install --quiet ifaddr psutil 
                echo "D√©pendances install√©es : ifaddr, psutil"
                echo "::endgroup::"
                
                echo "::group::üöÄ Ex√©cution du script mysystem.py"
                if python script/mysystem/mysystem.py; then
                  echo "::endgroup::"
                  echo "::notice title=‚úÖ Script ex√©cut√©::mysystem.py s'est ex√©cut√© sans erreur"
                else
                  echo "::endgroup::"
                  echo "::error file=script/mysystem/mysystem.py,title=‚ùå Erreur d'ex√©cution::Le script a rencontr√© une erreur pendant l'ex√©cution"
                  exit 1
                fi
